# pages/20_üìò_Utilisation.py

import streamlit as st
import re
from textwrap import dedent
from pathlib import Path

st.set_page_config(
page_title="üìò User Guide ‚Äî Utilisation / Usage",
page_icon="üìò",
layout="wide",
)

# ============================================================

# BILINGUAL CONTENT (self-contained)

# ============================================================

MANUAL_MD_FR = dedent(r"""

# üìò Mode d‚Äôemploi ‚Äî Utilisation d√©taill√©e (pas-√†-pas)

> Cette page explique **exactement** comment :  
> **1)** Ajouter des **proxies** (formats, tests, rotation, param√®tres recommand√©s)  
> **2)** **Lancer une recherche** / cr√©er un Job (tous les champs + profils conseill√©s)  
> **3)** **Trier / Filtrer / Rechercher** dans les r√©sultats  
> **4)** **Exporter** (CSV depuis le dashboard & via SQL)  
> **5)** Recettes pr√™tes √† l‚Äôemploi & **D√©pannage rapide**

---

## 1) Ajouter des proxies ‚Äî simple & complet

### 1.1 Ajout via l‚Äôinterface (recommand√©)

1. Ouvrez **üåê Gestion des Proxies**.
2. Cliquez **Importer** (ou **Ajouter des proxies**).
3. Collez **une ligne par proxy** (formats accept√©s) :
   IP:PORT
   IP:PORT:USER:PASS
   http://USER:PASS@IP:PORT
   https://USER:PASS@HOST:PORT
   socks5://USER:PASS@HOST:PORT

markdown
Copier le code
**Exemples valides**
51.38.12.34:3128
185.23.44.10:1080:user123:passABC
http://user:pw@198.51.100.7:8080
https://user:pw@proxy.vendor.net:8443
socks5://login:secret@203.0.113.9:9050

markdown
Copier le code 4. Cliquez **Tester** ‚Üí attendez le r√©sultat.

- **OK** = latence raisonnable + authentification r√©ussie
- **KO** = v√©rifiez login/mot de passe, protocole (http/https/socks5), IP/port

5. S√©lectionnez les lignes **OK** puis **Activer** (ou **Enregistrer**).

**Contr√¥les rapides**

- _Statut_ : **Actif**
- _Latence_ : **< 1500 ms** (viser < 800 ms si possible)
- _Taux d‚Äô√©chec test_ : **< 5‚Äì10 %**

---

### 1.2 Import par fichier (si propos√©)

1. **Importer depuis un fichier** `.txt` ou `.csv` (1 proxy/ligne, m√™mes formats).
2. Lancez **Tester** puis **Activer** uniquement les **OK**.
   > Astuce : gardez un `proxies.csv` (priv√©) versionn√© pour l‚Äô√©quipe.

---

### 1.3 Rotation & fiabilit√© (r√©glages d√©taill√©s)

Dans **‚öôÔ∏è Param√®tres** (ou `config/proxy_config.json`) :

- **Mode de rotation**
- `round_robin` : parcourt en boucle (simple)
- `random` : al√©atoire (√©quilibrage basique)
- `weighted_random` : al√©atoire **pond√©r√©** (recommand√© si pool mixte DC/Residential)
- `sticky_session` : conserve la **m√™me IP** durant un TTL (sessions/login)
- **Sticky TTL** : dur√©e en secondes (ex. **180 s**)
- **RPS max** (requ√™tes/seconde)
- Datacenter : **1.0‚Äì2.0**
- R√©sidentiel : **0.3‚Äì0.8**
- **Circuit-breaker / Cooldown**
- _Seuil d‚Äô√©checs_ (ex. **5**) ‚Üí _repos_ **60‚Äì120 s**
- **Warm-up**
- mont√©e en charge douce (ex. +1 req / 10 s)

**R√©glage de d√©part conseill√©**

- Rotation : `weighted_random`
- Sticky TTL : **120‚Äì180 s** (sites sensibles)
- RPS : **0.5** (r√©sidentiel) / **1.5** (datacenter)
- Circuit-breaker : **5** √©checs ‚Üí cooldown **90 s**

---

### 1.4 V√©rifier que le pool est pr√™t

- Lancer un **petit job test** (cf. ¬ß2) sur 2‚Äì3 pages publiques.
- Surveiller : **taux de r√©ussite par proxy**, **latence**, **403/429**, **timeouts**.
- Ajuster **Concurrence**, **Delay** et la **Rotation** si besoin.

---

## 2) Lancer une recherche (cr√©er un Job)

### 2.1 Champs √† remplir (pas-√†-pas)

1. **üéØ Gestionnaire de Jobs** ‚Üí **Cr√©er un Job**
2. **Sources**

- **URLs** (1 par ligne) ‚Äî _ex._
  ```
  https://exemple.com/recherche?q=chaussures
  https://exemple.com/categorie/page/1
  https://autre-site.fr/listing
  ```
- **Pays** _(optionnel)_ : 1 ou plusieurs
- **Langue** _(optionnel)_ : `auto` / `fr` / `en` / ‚Ä¶

3. **Comportement**

- **JavaScript (Playwright)** :
  - **‚ùå D√©sactiv√©** = sites **statiques**
  - **‚úÖ Activ√©** = sites **dynamiques (SPA/JS)**
- **Concurrence** :
  - sans JS : **6‚Äì12**
  - avec JS : **2‚Äì4**
- **Download Delay** : **0.5‚Äì1.5 s** (sites sensibles : ‚Üë)
- **Retry/Backoff** : **2‚Äì3** tentatives (timeouts/429)
- **Proxies** : v√©rifiez que le **pool actif** est s√©lectionn√© (si choix dans l‚ÄôUI)

4. **Ciblage & limites**

- **Mots-cl√©s** (inclure/exclure) si propos√©s
- **Profondeur / pages max** : **3‚Äì5** pour tests, ‚Üë en prod
- **Priorit√©** du job (si file d‚Äôattente)

5. **Planification** (si dispo) : ex√©cution **imm√©diate** ou **r√©p√©t√©e** (quot., hebdo, ‚Ä¶)
6. Cliquez **üöÄ START SCRAPING**.

### 2.2 Profils conseill√©s

- **Site statique** : JS **‚ùå** | Concurrence **8‚Äì12** | Delay **~1 s** | Retry **2**
- **Site dynamique (SPA)** : JS **‚úÖ** | Concurrence **2‚Äì4** | Delay **1‚Äì1.5 s** | Timeout **‚Üë** | Sticky **souvent utile**

---

## 3) Suivre l‚Äôex√©cution & diagnostiquer

- **üìä Tableau de bord** : √©tats **Pending / Active / Completed / Failed**
- **D√©tails du job** : progression, derni√®res URLs, erreurs cat√©goris√©es
- **Logs (avanc√©)** :

````bash
docker logs -f <nom_du_worker>
Signaux d‚Äôalerte & actions

403 / 429 ‚Üí Concurrence ‚Üì, Delay ‚Üë, Rotation/Sticky ON, Cooldown

Timeouts JS ‚Üí Timeout ‚Üë, attendre s√©lecteurs (wait for selector), tester sans JS si fallback HTML

√âchecs √©lev√©s ‚Üí v√©rifier pool proxy, mode weighted_random, RPS ‚Üì

4) R√©sultats : trier, filtrer, rechercher
Ouvrez üìá Explorateur de Contacts (ou ‚ÄúR√©sultats‚Äù).

4.1 Trier
Cliquez sur l‚Äôen-t√™te d‚Äôune colonne pour trier asc/desc

Tris utiles : created_at (r√©cents), domain, country, score (si pr√©sent)

4.2 Filtrer (exemples)
Pays : FR ; Langue : fr

P√©riode : ‚ÄúDerniers 7 jours‚Äù

Texte : gmail.com pour cibler des emails Gmail

Non vides : garder les lignes avec email rempli

4.3 Rechercher
Zone Rechercher (plein-texte) sur nom/titre/email/domaine (selon sch√©ma)

5) Exporter (CSV & SQL)
5.1 Export depuis le Dashboard
üìá Explorateur de Contacts ‚Üí appliquer filtres/tri

‚¨áÔ∏è Export CSV (ou ‚¨áÔ∏è Export Emails)

CSV filtr√© : exporte les lignes visibles/filtr√©es (selon impl√©mentation)

CSV complet : si bouton/option d√©di√©(e)

Si Excel n‚Äôaffiche pas correctement : importer le fichier en UTF-8 via Donn√©es ‚Üí √Ä partir d‚Äôun fichier texte/CSV.

Bonnes pratiques

Contr√¥lez 20‚Äì50 lignes (colonnes, accents)

Rangez : exports/2025-09-25_contacts_FR.csv

5.2 Export via PostgreSQL (avanc√©)
sql
Copier le code
-- Pr√©visualiser
SELECT * FROM public.contacts
ORDER BY created_at DESC
LIMIT 100;

-- Export CSV (psql)
\copy (SELECT * FROM public.contacts) TO 'contacts.csv' WITH CSV HEADER;

-- Filtrer : France + email non nul
SELECT * FROM public.contacts
WHERE country = 'FR' AND email IS NOT NULL
ORDER BY created_at DESC;

-- D√©doublonner par email (garder la plus r√©cente)
SELECT DISTINCT ON (email) *
FROM public.contacts
WHERE email IS NOT NULL
ORDER BY email, created_at DESC;

-- Garder certains domaines
SELECT * FROM public.contacts
WHERE email LIKE '%@gmail.com' OR email LIKE '%@proton.me';
6) Recettes rapides
A) Test √©clair (statique)

Proxies : optionnel ; JS : ‚ùå ; Concurrence 8 ; Delay 1.0s ; 3‚Äì5 URLs

B) Cible SPA (anti-bot l√©ger)

Proxies : datacenter (‚â• 10 IP) ; JS : ‚úÖ ; Concurrence 3 ; Delay 1.5s ; Sticky TTL 180s

C) Emails qualifi√©s (FR, r√©cents)

Filtre : Pays=FR + email non vide + p√©riode 30j ‚Üí Export CSV

7) D√©pannage rapide (FAQ)
Dashboard KO

docker compose ps ; docker logs -f <dashboard>

Job pending/failed

Worker up ; Concurrence ‚Üì, Delay ‚Üë ; JS ON si SPA

403/429

Rotation/Sticky ON ; Concurrence ‚Üì, Delay ‚Üë ; Cooldown ; pool r√©sidentiel

Timeouts/JS

Timeout ‚Üë ; attendre s√©lecteurs ; tester sans JS si fallback HTML

Export vide

V√©rifier filtres ; pipelines DB ; relancer petit job de test

8) Checklist quotidienne ‚úÖ
 Proxies OK (tests verts, rotation, latence)

 Param√®tres adapt√©s (JS, Concurrence, Delay, Retry)

 Jobs planifi√©s correctement

 Exports v√©rifi√©s (√©chantillon)

 Monitoring consult√© (erreurs, latence, ressources)
""").strip("\n")

MANUAL_MD_EN = dedent(r"""

üìò User Guide ‚Äî Detailed Usage (Step-by-Step)
This page explains exactly how to:
1) Add proxies (formats, testing, rotation, recommended settings)
2) Start a search / create a Job (all fields + suggested profiles)
3) Sort / Filter / Search results
4) Export (CSV from dashboard & via SQL)
5) Ready-made recipes & Quick troubleshooting

1) Add proxies ‚Äî simple & complete
1.1 Via the interface (recommended)
Open üåê Proxy Management.

Click Import (or Add proxies).

Paste one proxy per line (accepted formats):

sql
Copier le code
IP:PORT
IP:PORT:USER:PASS
http://USER:PASS@IP:PORT
https://USER:PASS@HOST:PORT
socks5://USER:PASS@HOST:PORT
Valid examples

perl
Copier le code
51.38.12.34:3128
185.23.44.10:1080:user123:passABC
http://user:pw@198.51.100.7:8080
https://user:pw@proxy.vendor.net:8443
socks5://login:secret@203.0.113.9:9050
Click Test ‚Üí wait for results.

OK = reasonable latency + successful auth

KO = check credentials, protocol (http/https/socks5), IP/port

Select OK rows then Enable (or Save).

Quick checks

Status: Active

Latency: < 1500 ms (aim < 800 ms)

Failure rate (test): < 5‚Äì10%

1.2 Import from file (if provided)
Import from file .txt or .csv (1 proxy/line, same formats).

Test then Enable only the OK ones.

Tip: keep a private, versioned proxies.csv for the team.

1.3 Rotation & reliability (detailed)
In ‚öôÔ∏è Settings (or config/proxy_config.json):

Rotation mode

round_robin ‚Äî loop through (simple)

random ‚Äî random balancing

weighted_random ‚Äî random with weights (great for DC/Residential mix)

sticky_session ‚Äî keep the same IP during a TTL (session/login)

Sticky TTL: seconds (e.g. 180 s)

Max RPS (requests/sec)

Datacenter: 1.0‚Äì2.0

Residential: 0.3‚Äì0.8

Circuit-breaker / Cooldown

Failure threshold (e.g. 5) ‚Üí rest 60‚Äì120 s

Warm-up

gentle ramp-up (e.g. +1 request / 10 s)

Suggested baseline

Rotation: weighted_random

Sticky TTL: 120‚Äì180 s (sensitive sites)

RPS: 0.5 (residential) / 1.5 (datacenter)

Circuit-breaker: 5 fails ‚Üí 90 s cooldown

1.4 Validate pool readiness
Run a small test job (see ¬ß2) on 2‚Äì3 public pages.

Watch: success rate per proxy, latency, 403/429, timeouts.

Tune Concurrency, Delay, and Rotation if needed.

2) Start a search (create a Job)
2.1 Fields (step-by-step)
üéØ Job Manager ‚Üí Create Job

Sources

URLs (1 per line) ‚Äî e.g.

ruby
Copier le code
https://example.com/search?q=shoes
https://example.com/category/page/1
https://another-site.io/listing
Country (optional): 1+

Language (optional): auto / en / fr / ‚Ä¶

Behavior

JavaScript (Playwright):

‚ùå Off = static sites

‚úÖ On = dynamic (SPA/JS) sites

Concurrency:

no JS: 6‚Äì12

with JS: 2‚Äì4

Download Delay: 0.5‚Äì1.5 s (increase for sensitive sites)

Retry/Backoff: 2‚Äì3 attempts (timeouts/429)

Proxies: ensure active pool is selected (if UI offers it)

Targeting & limits

Include/Exclude keywords (if available)

Depth / max pages: 3‚Äì5 for tests, ‚Üë for prod

Priority (if queueing)

Scheduling (if available): immediate or recurring (daily/weekly/‚Ä¶)

Click üöÄ START SCRAPING.

2.2 Suggested profiles
Static site: JS ‚ùå | Concurrency 8‚Äì12 | Delay ~1 s | Retry 2

Dynamic (SPA): JS ‚úÖ | Concurrency 2‚Äì4 | Delay 1‚Äì1.5 s | Timeout ‚Üë | Sticky often helpful

3) Monitor & diagnose
üìä Dashboard: states Pending / Active / Completed / Failed

Job details: progress, latest URLs, categorized errors

Logs (advanced):

bash
Copier le code
docker logs -f <worker_name>
Red flags & actions

403 / 429 ‚Üí Concurrency ‚Üì, Delay ‚Üë, Rotation/Sticky ON, Cooldown

JS timeouts ‚Üí Timeout ‚Üë, wait for stable selectors, try No-JS if HTML fallback

High failures ‚Üí check proxy pool, switch to weighted_random, reduce RPS

4) Results: sort, filter, search
Open üìá Contacts Explorer (or ‚ÄúResults‚Äù).

4.1 Sort
Click a column header to toggle asc/desc

Useful: created_at (latest first), domain, country, score (if any)

4.2 Filter (examples)
Country: FR ; Language: fr

Date range: ‚ÄúLast 7 days‚Äù

Text: gmail.com to target Gmail emails

Non-empty: keep rows with email filled

4.3 Search
Full-text Search box across name/title/email/domain (depending on schema)

5) Export (CSV & SQL)
5.1 From the Dashboard
üìá Contacts Explorer ‚Üí apply filters/sort

‚¨áÔ∏è Export CSV (or ‚¨áÔ∏è Export Emails)

Filtered CSV: exports visible/filtered rows (depending on implementation)

Full CSV: if there is a dedicated button/option

If Excel shows weird characters: import as UTF-8 via Data ‚Üí From text/CSV.

Good practice

Check 20‚Äì50 lines sample (columns, accents)

Store as: exports/2025-09-25_contacts_FR.csv

5.2 Via PostgreSQL (advanced)
sql
Copier le code
-- Preview
SELECT * FROM public.contacts
ORDER BY created_at DESC
LIMIT 100;

-- CSV export (psql)
\copy (SELECT * FROM public.contacts) TO 'contacts.csv' WITH CSV HEADER;

-- Filter: France + non-null email
SELECT * FROM public.contacts
WHERE country = 'FR' AND email IS NOT NULL
ORDER BY created_at DESC;

-- Deduplicate by email (keep most recent)
SELECT DISTINCT ON (email) *
FROM public.contacts
WHERE email IS NOT NULL
ORDER BY email, created_at DESC;

-- Keep specific email domains
SELECT * FROM public.contacts
WHERE email LIKE '%@gmail.com' OR email LIKE '%@proton.me';
6) Quick recipes
A) Quick static test

Proxies: optional ; JS: ‚ùå ; Concurrency 8 ; Delay 1.0s ; 3‚Äì5 URLs

B) SPA target (light anti-bot)

Proxies: datacenter (‚â• 10 IP) ; JS: ‚úÖ ; Concurrency 3 ; Delay 1.5s ; Sticky TTL 180s

C) Qualified emails (FR, recent)

Explorer filters: Country=FR + email not null + last 30 days ‚Üí CSV export

7) Quick troubleshooting (FAQ)
Dashboard down

docker compose ps ; docker logs -f <dashboard>

Job pending/failed

Worker running ; Concurrency ‚Üì, Delay ‚Üë ; JS ON if SPA

403/429

Rotation/Sticky ON ; Concurrency ‚Üì, Delay ‚Üë ; Cooldown ; consider residential pool

Timeouts/JS

Timeout ‚Üë ; wait for selectors ; try No-JS if HTML fallback

Empty export

Check filters ; DB pipelines ; rerun a small test job

8) Daily checklist ‚úÖ
 Proxies OK (green tests, rotation, latency)

 Proper settings (JS, Concurrency, Delay, Retry)

 Scheduled jobs configured

 Exports verified (sample)

 Monitoring reviewed (errors, latency, resources)
""").strip("\n")

============================================================
OPTIONAL: allow loading from /docs if present (overrides)
============================================================
ROOT = Path(file).resolve().parents[1]
DOCS_DIR = ROOT / "docs"
FR_FILE = DOCS_DIR / "manuel_utilisation_fr.md"
EN_FILE = DOCS_DIR / "manual_en.md"

def maybe_load(path: Path, fallback: str) -> str:
return path.read_text(encoding="utf-8") if path.exists() else fallback

============================================================
Helpers: TOC, anchors, search highlighting
============================================================
def make_toc(md_text: str):
toc = []
for line in md_text.splitlines():
m = re.match(r"^(#{1,6})\s+(.*)", line.strip())
if m:
level = len(m.group(1))
title = m.group(2).strip()
anchor = re.sub(r"[^a-z0-9- ]", "", title.lower())
anchor = re.sub(r"\s+", "-", anchor)
toc.append((level, title, anchor))
return toc

def inject_anchors(md_text: str):
out = []
for line in md_text.splitlines():
m = re.match(r"^(#{1,6})\s+(.*)", line)
if m:
title = m.group(2).strip()
anchor = re.sub(r"[^a-z0-9- ]", "", title.lower())
anchor = re.sub(r"\s+", "-", anchor)
out.append(f'<a id="{anchor}"></a>')
out.append(line)
return "\n".join(out)

def highlight_query(md_text: str, query: str) -> str:
if not query:
return md_text
pattern = re.compile(re.escape(query), re.IGNORECASE)
return pattern.sub(lambda m: f"{m.group(0)}", md_text)

============================================================
Sidebar: Language
============================================================
st.sidebar.header("Help / Aide")
lang = st.sidebar.selectbox("Language / Langue", ["English", "Fran√ßais"], index=0)
st.sidebar.caption("Switch language here to view the manual in EN or FR.")

Load content (prefer /docs if present)
md_fr = maybe_load(FR_FILE, MANUAL_MD_FR)
md_en = maybe_load(EN_FILE, MANUAL_MD_EN)
active_md = md_en if lang == "English" else md_fr

============================================================
Header
============================================================
c1, c2 = st.columns([3, 2])
with c1:
st.title("üìò User Guide ‚Äî Utilisation / Usage")
with c2:
st.download_button(
"‚¨áÔ∏è Download / T√©l√©charger (Markdown)",
data=active_md,
file_name="user_guide_usage.md" if lang == "English" else "mode_emploi_utilisation.md",
mime="text/markdown",
use_container_width=True,
)

st.caption("Tip / Astuce : use the Table of Contents or the search box below.")

query = st.text_input(
"üîé Search / Rechercher (e.g. proxy, export, 429, delay‚Ä¶) | (ex. proxy, export, 429, d√©lai‚Ä¶)",
placeholder="Type a keyword then press Enter / Tapez un mot-cl√© puis Entr√©e",
).strip()

TOC
toc = make_toc(active_md)
with st.expander("üß≠ Table of Contents / Sommaire", expanded=True):
for level, title, anchor in toc:
indent = "¬†" * (level - 1) * 4
st.markdown(f"{indent}‚Ä¢ {title}", unsafe_allow_html=True)

Render with anchors + highlight
render_md = highlight_query(active_md, query) if query else active_md
st.markdown(inject_anchors(render_md), unsafe_allow_html=True)

st.divider()
with st.expander("üìå Quick recap / Rappel express"):
st.markdown("""

Proxies ‚Üí üåê Proxy Management / Gestion des Proxies ‚Üí Import ‚Üí Test ‚Üí Enable/Activer

Job ‚Üí üéØ Job Manager / Gestionnaire de Jobs ‚Üí URLs ‚Üí JS (if SPA / si SPA) ‚Üí Concurrency/Delay ‚Üí üöÄ START

Export ‚Üí üìá Contacts Explorer ‚Üí ‚¨áÔ∏è Export CSV (or ‚¨áÔ∏è Export Emails)

Troubleshoot ‚Üí docker compose ps, docker logs -f <service>
""")

st.caption("¬© Your Company ‚Äî Embedded help. Update this page or /docs to evolve the manual.")

yaml
Copier le code

---

# 2) Fichiers docs bilingues

> Place-les dans le d√©p√¥t pour **√©dition facile** (et la page ci-dessus les lira automatiquement si pr√©sents).

## `docs/manuel_utilisation_fr.md`

```markdown
# üìò Mode d‚Äôemploi ‚Äî Utilisation (FR)

Ce guide d√©taille : **proxies**, **lancement de jobs**, **tri/filtre/recherche**, **export CSV & SQL**, **recettes**, **d√©pannage**.

## Proxies
- **üåê Gestion des Proxies** ‚Üí **Importer**
- Formats :
IP:PORT
IP:PORT:USER:PASS
http://USER:PASS@IP:PORT
https://USER:PASS@HOST:PORT
socks5://USER:PASS@HOST:PORT

markdown
Copier le code
- **Tester** puis **Activer** uniquement les **OK**.
- R√©glages (‚öôÔ∏è / `config/proxy_config.json`) : `weighted_random`, **Sticky TTL** 120‚Äì180s, **RPS** 0.5 (r√©sidentiel) / 1.5 (DC), **Circuit-breaker** 5 ‚Üí cooldown 90s.

## Lancer un Job
1. **üéØ Gestionnaire de Jobs** ‚Üí **Cr√©er un Job**
2. URLs (1/ligne), Pays/Langue (optionnel), JS on/off (Playwright), Concurrence (2‚Äì4 avec JS / 6‚Äì12 sans), Delay 0.5‚Äì1.5s, Retry 2‚Äì3.
3. **üöÄ START SCRAPING**.

## Trier / Filtrer / Rechercher
- **üìá Explorateur de Contacts** ‚Üí tri par colonnes, filtres (pays/langue/p√©riode), recherche plein-texte (ex. `gmail.com`), valeurs non vides (email).

## Export
- **‚¨áÔ∏è Export CSV** / **‚¨áÔ∏è Export Emails** (filtres pris en compte selon impl√©mentation).
- SQL (psql) :
```sql
\copy (SELECT * FROM public.contacts) TO 'contacts.csv' WITH CSV HEADER;
SELECT DISTINCT ON (email) * FROM public.contacts WHERE email IS NOT NULL ORDER BY email, created_at DESC;
Recettes
Statique : JS ‚ùå, Concurrence 8‚Äì12, Delay ~1s.

SPA : JS ‚úÖ, Concurrence 2‚Äì4, Delay 1‚Äì1.5s, Sticky TTL 180s.

D√©pannage
Dashboard KO : docker compose ps, docker logs -f <dashboard>

403/429 : Concurrence ‚Üì, Delay ‚Üë, Rotation/Sticky ON, Cooldown, pool r√©sidentiel

Timeouts JS : Timeout ‚Üë, wait-for-selector, tester sans JS si fallback HTML.

markdown
Copier le code

## `docs/manual_en.md`

```markdown
# üìò User Guide ‚Äî Usage (EN)

This guide covers: **proxies**, **starting jobs**, **sort/filter/search**, **CSV & SQL exports**, **recipes**, **troubleshooting**.

## Proxies
- **üåê Proxy Management** ‚Üí **Import**
- Formats:
IP:PORT
IP:PORT:USER:PASS
http://USER:PASS@IP:PORT
https://USER:PASS@HOST:PORT
socks5://USER:PASS@HOST:PORT

pgsql
Copier le code
- **Test** then **Enable** only **OK** rows.
- Settings (‚öôÔ∏è / `config/proxy_config.json`): `weighted_random`, **Sticky TTL** 120‚Äì180s, **RPS** 0.5 (residential) / 1.5 (DC), **Circuit-breaker** 5 ‚Üí cooldown 90s.

## Start a Job
1. **üéØ Job Manager** ‚Üí **Create Job**
2. URLs (1/line), Country/Language (optional), JS on/off (Playwright), Concurrency (2‚Äì4 with JS / 6‚Äì12 no-JS), Delay 0.5‚Äì1.5s, Retry 2‚Äì3.
3. **üöÄ START SCRAPING**.

## Sort / Filter / Search
- **üìá Contacts Explorer** ‚Üí column sort, filters (country/language/date), full-text search (e.g. `gmail.com`), non-empty fields (email).

## Export
- **‚¨áÔ∏è Export CSV** / **‚¨áÔ∏è Export Emails** (filters considered depending on implementation).
- SQL (psql):
```sql
\copy (SELECT * FROM public.contacts) TO 'contacts.csv' WITH CSV HEADER;
SELECT DISTINCT ON (email) * FROM public.contacts WHERE email IS NOT NULL ORDER BY email, created_at DESC;
Recipes
Static: JS ‚ùå, Concurrency 8‚Äì12, Delay ~1s.

SPA: JS ‚úÖ, Concurrency 2‚Äì4, Delay 1‚Äì1.5s, Sticky TTL 180s.

Troubleshooting
Dashboard down: docker compose ps, docker logs -f <dashboard>

403/429: Concurrency ‚Üì, Delay ‚Üë, Rotation/Sticky ON, Cooldown, residential pool

JS timeouts: Timeout ‚Üë, wait-for-selector, try No-JS if HTML fallback.

yaml
Copier le code

---

## Int√©gration (rappel)

- Ajoute la page dans la **sidebar** (dans `app.py`) :
  ```python
  import streamlit as st
  st.sidebar.page_link("pages/20_üìò_Utilisation.py", label="üìò Mode d‚Äôemploi / User Guide")
(Optionnel) Copie les docs :

dockerfile
Copier le code
# Dockerfile.dashboard
COPY pages/ /app/pages/
COPY docs/ /app/docs/
Red√©ploie le dashboard :

bash
Copier le code
docker compose build dashboard --no-cache
docker compose up -d dashboard
Tu auras ainsi : une page d‚Äôaide bilingue int√©gr√©e + deux fichiers docs FR/EN que ton √©quipe peut √©diter sans toucher au code.
````
